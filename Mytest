import com.jcraft.jsch.ChannelSftp;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.Session;

import java.io.*;
import java.nio.charset.StandardCharsets;
import java.util.Properties;

public class SftpAsciiUpload {

    // Method to upload a file in ASCII format
    public static void uploadFileAsAscii(String host, String username, String password, String localFilePath, String remoteFilePath) throws Exception {
        // Create a new session
        JSch jsch = new JSch();
        Session session = jsch.getSession(username, host, 22);
        session.setPassword(password);

        // Configure the session for no host key checking
        Properties config = new Properties();
        config.put("StrictHostKeyChecking", "no");
        session.setConfig(config);
        session.connect();

        // Open the SFTP channel
        ChannelSftp channelSftp = (ChannelSftp) session.openChannel("sftp");
        channelSftp.connect();

        // Read the local file as ASCII
        try (BufferedReader reader = new BufferedReader(new FileReader(localFilePath))) {
            // Use ByteArrayOutputStream to hold the ASCII bytes
            ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
            String line;
            
            // Read the file line by line, and convert to ASCII format
            while ((line = reader.readLine()) != null) {
                // Convert the line to ASCII and append CRLF for Windows compatibility
                byteArrayOutputStream.write((line + "\r\n").getBytes(StandardCharsets.US_ASCII));
            }

            // Upload the file using ASCII transfer mode
            try (InputStream inputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray())) {
                channelSftp.put(inputStream, remoteFilePath, ChannelSftp.OVERWRITE); // Use OVERWRITE mode
            }
        }

        // Close the SFTP channel and session
        channelSftp.disconnect();
        session.disconnect();

        System.out.println("File uploaded successfully in ASCII format.");
    }

    public static void main(String[] args) {
        try {
            // SFTP details
            String sftpHost = "your.mainframe.host.com"; // Replace with your mainframe host
            String sftpUsername = "your-username"; // Replace with your SFTP username
            String sftpPassword = "your-password"; // Replace with your SFTP password
            String localFilePath = "path/to/your/local/file.txt"; // Replace with your local file path
            String remoteFilePath = "/path/on/mainframe/file.txt"; // Specify the remote path

            // Upload the file in ASCII format
            uploadFileAsAscii(sftpHost, sftpUsername, sftpPassword, localFilePath, remoteFilePath);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
