jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Set environment-specific variables
        run: |
          # Dynamically construct environment-specific variable names
          KUBE_URL_VAR="KUBE_${{ env.ENVIRONMENT }}_URL"
          KUBE_USER_VAR="KUBE_${{ env.ENVIRONMENT }}_USER"
          KUBE_PASSWORD_VAR="KUBE_${{ env.ENVIRONMENT }}_PASSWORD"

          # Print for debugging purposes (optional)
          echo "Constructed KUBE_URL_VAR=$KUBE_URL_VAR"
          echo "Constructed KUBE_USER_VAR=$KUBE_USER_VAR"
          echo "Constructed KUBE_PASSWORD_VAR=$KUBE_PASSWORD_VAR"

          # Use indirect parameter expansion in bash to get the actual values
          KUBE_URL=${!KUBE_URL_VAR}
          KUBE_USER=${!KUBE_USER_VAR}
          KUBE_PASSWORD=${!KUBE_PASSWORD_VAR}

          # Export these to make them available to subsequent steps
          echo "KUBE_URL=$KUBE_URL" >> $GITHUB_ENV
          echo "KUBE_USER=$KUBE_USER" >> $GITHUB_ENV
          echo "KUBE_PASSWORD=$KUBE_PASSWORD" >> $GITHUB_ENV

      - name: Use dynamic environment variables
        run: |
          echo "Cluster URL: $KUBE_URL"
          echo "Service Account Name: $KUBE_USER"
          echo "Service Account Password: $KUBE_PASSWORD"
