import com.jcraft.jsch.ChannelSftp;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.Session;

import java.io.*;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.util.Properties;

public class MainframeFileTransfer {

    // Method to upload XML file to the mainframe
    public static void uploadXmlToMainframe(String host, String username, String password, String localFilePath) throws Exception {
        JSch jsch = new JSch();
        Session session = jsch.getSession(username, host, 22);
        session.setPassword(password);

        // Configure the session for no host key checking
        Properties config = new Properties();
        config.put("StrictHostKeyChecking", "no");
        session.setConfig(config);
        session.connect();

        ChannelSftp channelSftp = (ChannelSftp) session.openChannel("sftp");
        channelSftp.connect();

        // Read the local XML file with UTF-8 encoding
        File file = new File(localFilePath);
        String xmlContent = new String(Files.readAllBytes(file.toPath()), StandardCharsets.UTF_8);

        // Replace line endings with CRLF (Windows style) if necessary
        xmlContent = xmlContent.replace("\n", "\r\n");

        // Convert to bytes
        byte[] xmlBytes = xmlContent.getBytes(StandardCharsets.UTF_8);

        // Use ByteArrayInputStream to upload the file
        try (ByteArrayInputStream byteInputStream = new ByteArrayInputStream(xmlBytes)) {
            String remoteFilePath = "/default/path/on/mainframe/file.xml"; // Specify the path
            channelSftp.put(byteInputStream, remoteFilePath, ChannelSftp.OVERWRITE);
        }

        // Close connections
        channelSftp.disconnect();
        session.disconnect();

        System.out.println("XML file uploaded successfully to the mainframe.");
    }

    public static void main(String[] args) {
        try {
            // Mainframe SFTP details
            String sftpHost = "mainframe.host.com";
            String sftpUsername = "your-username";
            String sftpPassword = "your-password";
            String localFilePath = "path/to/local/file.xml";  // Your local XML file path

            // Upload XML file to mainframe
            uploadXmlToMainframe(sftpHost, sftpUsername, sftpPassword, localFilePath);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
