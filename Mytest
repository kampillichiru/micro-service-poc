import com.jcraft.jsch.ChannelSftp;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.Session;

import java.io.*;
import java.nio.charset.Charset;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Properties;

public class MainframeFileTransfer {

    // Method to upload file to the mainframe using IBM1047 encoding
    public static void uploadToMainframe(String host, String username, String password, String localFilePath) throws Exception {
        JSch jsch = new JSch();
        Session session = jsch.getSession(username, host, 22);
        session.setPassword(password);

        // Configure the session for no host key checking
        Properties config = new Properties();
        config.put("StrictHostKeyChecking", "no");
        session.setConfig(config);

        session.connect();

        ChannelSftp channelSftp = (ChannelSftp) session.openChannel("sftp");
        channelSftp.connect();

        // Read the local file
        File file = new File(localFilePath);
        Charset localCharset = Charset.forName("UTF-8"); // Adjust if your input file has a specific encoding
        byte[] fileBytes = Files.readAllBytes(file.toPath());
        String fileContent = new String(fileBytes, localCharset);

        // Replace line endings with CRLF
        fileContent = fileContent.replace("\n", "\r\n");

        // Convert to IBM1047 encoding
        Charset ibm1047Charset = Charset.forName("IBM1047");
        byte[] ibm1047Bytes = fileContent.getBytes(ibm1047Charset);

        // Use ByteArrayInputStream to upload the file
        try (ByteArrayInputStream byteInputStream = new ByteArrayInputStream(ibm1047Bytes)) {
            String remoteFilePath = "/default/path/on/mainframe/file.txt"; // Change to your path
            channelSftp.put(byteInputStream, remoteFilePath, ChannelSftp.OVERWRITE);
        }

        // Close connections
        channelSftp.disconnect();
        session.disconnect();

        System.out.println("File uploaded successfully to the mainframe in IBM1047 encoding.");
    }

    public static void main(String[] args) {
        try {
            // Mainframe SFTP details
            String sftpHost = "mainframe.host.com";
            String sftpUsername = "your-username";
            String sftpPassword = "your-password";
            String localFilePath = "path/to/local/file.txt";  // Your local file path

            // Upload file to mainframe
            uploadToMainframe(sftpHost, sftpUsername, sftpPassword, localFilePath);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
